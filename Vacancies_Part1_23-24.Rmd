---
title: "Part 1 Staffing/Vacancies Measure of Central Tendency"
author: Maura Carter
date: 10-03-2024
output: html_notebook
---

1. Summative Analysis of Vacancies

Include central tendency and variation by subject, grade, grade-subject, campus, campus-subject, region, region-subject

a) subject    (col: course credit type)          
b) **grade 
c) **grade-subject
d) campus
e) campus-subject
f) region
g) region-subject



#1) How long are vacancies (median and mean and SD)?
#2) How many vacancies (median, mean and SD)?
#3) What is the most # of vacancies at one "time" (time = week, month, quarter, semester)?
#4) Add box plots and histograms. 


#CHECKLIST - (Both VACANCIES and FMLA outputs)

#VACANCIES
a) subject    (col: course credit type)
 YES #1) How long are vacancies (median and mean and SD)? 
 YES #2) How many vacancies (median, mean and SD)?
  YES #3) What is the most # of vacancies at one "time" (time = week, month, quarter, semester)?
BAR/HIST  #4) Add box plots and histograms. 


b) **grade
  #1) How long are vacancies (median and mean and SD)?
  #2) How many vacancies (median, mean and SD)?
  #3) What is the most # of vacancies at one "time" (time = week, month, quarter, semester)?
  #4) Add box plots and histograms. 

c) **grade-subject
  #1) How long are vacancies (median and mean and SD)?
  #2) How many vacancies (median, mean and SD)?
  #3) What is the most # of vacancies at one "time" (time = week, month, quarter, semester)?
  #4) Add box plots and histograms. 


d) campus
  YES #1) How long are vacancies (median and mean and SD)?
  YES #2) How many vacancies (median, mean and SD)?
  #3) What is the most # of vacancies at one "time" (time = week, month, quarter, semester)?
 BAR  #4) Add box plots and histograms. 


e) campus-subject
  #1) How long are vacancies (median and mean and SD)?
  #2) How many vacancies (median, mean and SD)?
  #3) What is the most # of vacancies at one "time" (time = week, month, quarter, semester)?
  #4) Add box plots and histograms. 


f) region
 YES #1) How long are vacancies (median and mean and SD)?
 YES #2) How many vacancies (median, mean and SD)?
  YES #3) What is the most # of vacancies at one "time" (time = week, month, quarter, semester)?
 BAR/Hist #4) Add box plots and histograms. 


g) region-subject
  #1) How long are vacancies (median and mean and SD)?
  #2) How many vacancies (median, mean and SD)?
  #3) What is the most # of vacancies at one "time" (time = week, month, quarter, semester)?
  #4) Add box plots and histograms. 


#FMLA
a) subject    (col: course credit type)
 YES #1) How long are vacancies (median and mean and SD)?
 YES #2) How many vacancies (median, mean and SD)?
  #3) What is the most # of vacancies at one "time" (time = week, month, quarter, semester)?
 BAR/hist #4) Add box plots and histograms. 


b) **grade
  #1) How long are vacancies (median and mean and SD)?
  #2) How many vacancies (median, mean and SD)?
  #3) What is the most # of vacancies at one "time" (time = week, month, quarter, semester)?
  #4) Add box plots and histograms. 

c) **grade-subject
  #1) How long are vacancies (median and mean and SD)?
  #2) How many vacancies (median, mean and SD)?
  #3) What is the most # of vacancies at one "time" (time = week, month, quarter, semester)?
  #4) Add box plots and histograms. 


d) campus
  YES #1) How long are vacancies (median and mean and SD)?
  YES #2) How many vacancies (median, mean and SD)?
  #3) What is the most # of vacancies at one "time" (time = week, month, quarter, semester)?
  BAR #4) Add box plots and histograms. 


e) campus-subject
  #1) How long are vacancies (median and mean and SD)?
  #2) How many vacancies (median, mean and SD)?
  #3) What is the most # of vacancies at one "time" (time = week, month, quarter, semester)?
  #4) Add box plots and histograms. 


f) region
  YES #1) How long are vacancies (median and mean and SD)?
  YES #2) How many vacancies (median, mean and SD)?
  #3) What is the most # of vacancies at one "time" (time = week, month, quarter, semester)?
  BAR/hist #4) Add box plots and histograms. 


g) region-subject
  #1) How long are vacancies (median and mean and SD)?
  #2) How many vacancies (median, mean and SD)?
  #3) What is the most # of vacancies at one "time" (time = week, month, quarter, semester)?
  #4) Add box plots and histograms. 


# how to install ideadata package
https://rdrr.io/github/idea-analytics/ideadata/f/README.Rmd
``` {r install, eval=FALSE}

# install.packages("remotes")
library(remotes)
# remotes::install_github("idea-analytics/ideadata")
#remotes::install_github("idea-analytics/ideacolors")
library(ideacolors)
```


```{r merge}
#Merge PowerSchool data with data files
source("munge/merge_data.R")

#Glimpse to see columns/rows in the tables
#glimpse(courses_tm_fmla_staff) # !!! This is where we have total_days_out
#glimpse(jobvite_staffing_vacancies) # !!! This is where we have total_days_vacancy


#look at the tables in R
courses_tm_fmla_staff   #FMLA data (number of days off for FMLA)
jobvite_staffing_vacancies   #number of days vacancy
#jobvite



#write to csv
#write.csv(courses_tm_fmla_staff,"C:\\Users\\maura.carter\\Documents\\GitHub\\Staffing_Trends_Performance_Vacancies\\courses_tm_fmla_staff.csv", row.names = FALSE)

#write.csv(jobvite_staffing_vacancies,"C:\\Users\\maura.carter\\Documents\\GitHub\\Staffing_Trends_Performance_Vacancies\\jobvite_staffing_vacancies.csv", row.names = FALSE)

#read into R from a .csv
# jobvite_staffing_vacancies2 <- read.csv("C:\\Users\\maura.carter\\Documents\\GitHub\\Staffing_Trends_Performance_Vacancies\\jobvite_staffing_vacancies.csv", header = TRUE)
# jobvite_staffing_vacancies2



```

#F) Region
```{r}

#instructions
#1) How long are vacancies (median and mean and SD)?
#2) How many vacancies (median, mean and SD)?
#3) What is the most # of vacancies at one "time" (time = week, month, quarter, semester)?
#4) Add box plots and histograms. 

#-----------------------------------------

#1) How long are vacancies (median and mean and SD)?


#f-1) region - VACANCY
region_median_mean_sd <-jobvite_staffing_vacancies %>%
  mutate(Region = region.x) %>%
  filter(Region == "AUSTIN REGION" |
           Region == "EL PASO REGION" |
           Region == "GREATER HOUSTON REGION" |
           Region == "LOWER VALLEY RGV"|
           Region == "UPPER VALLEY RGV"|
           Region == "MID VALLEY RGV" |
           Region == "PERMIAN BASIN REGION" |
           Region == "SAN ANTONIO REGION" |
           Region == "TARRANT COUNTY REGION") %>%
  select(Region, total_days_vacancy) %>%
  group_by(Region)  %>%
  summarise(Median = median(total_days_vacancy),
            Mean = mean(total_days_vacancy),
            SD = sd(total_days_vacancy)) 
  # count()
region_median_mean_sd


#change data to numeric
# jobvite_staffing_vacancies$employee_id <- as.numeric(jobvite_staffing_vacancies$employee_id)
# jobvite_staffing_vacancies$total_days_vacancy <- as.numeric(jobvite_staffing_vacancies$total_days_vacancy)

#------------------------------------------------------

#f-1) region - FMLA

#Add Regions to the FMLA data
#get school number and region from schools and regions tables, join to FMLA table 
schools <- ideadata::get_schools() %>%
  mutate(school_number = SchoolNumber) %>%
  select(school_number, RegionAltID) %>%
  collect() 
schools

region <- get_table(.table_name = "Regions", .database_name = "PROD1", 
        .schema = "Schools", .server_name = "RGVPDSD-DWPRD1") %>%          #[RGVPDSD-DWPRD1].[PROD1].[Schools].[Regions]
  mutate(region_id = RegionID) %>%
  select(region_id, RegionDescription, State)
region

#join data
schools_FMLA <- left_join(courses_tm_fmla_staff, schools, by = "school_number") %>%
  mutate(region_id = RegionAltID)
schools_FMLA

schools_region_FMLA <- left_join(schools_FMLA, region, by = "region_id", copy = TRUE)
schools_region_FMLA

#Median, Mean, Mode: FMLA
region_FMLA_median_mean_sd <-schools_region_FMLA %>%
  mutate(Region = RegionDescription) %>%
  filter(Region == "Austin" |
           Region == "El Paso" |
           Region == "Greater Houston Area" |
           Region == "Lower Valley"|
           Region == "Upper Valley"|
           Region == "Mid Valley" |
           Region == "Permian Basin" |
           Region == "West San Antonio" |
           Region == "East San Antonio"  |
           Region == "Tarrant County") %>%
  select(Region, total_days_out) %>%
  filter(total_days_out >0) %>%
  group_by(Region)  %>%
  summarise(Median = median(total_days_out),
            Mean = mean(total_days_out),
            SD = sd(total_days_out)) 
  # count()
region_FMLA_median_mean_sd


#distinct regions
distinct_regions <- schools_region_FMLA %>%
  mutate(Region = RegionDescription) %>%
  select(Region) %>%
  distinct()
distinct_regions

```

#Region
#2) How many vacancies (median, mean and SD)?
```{r}

#2) How many vacancies are there? Count
#f-2 (region)
region_vacancy_count <-jobvite_staffing_vacancies %>%
  mutate(Region = region.x) %>%
  filter(Region == "AUSTIN REGION" |
           Region == "EL PASO REGION" |
           Region == "GREATER HOUSTON REGION" |
           Region == "LOWER VALLEY RGV"|
           Region == "UPPER VALLEY RGV"|
           Region == "MID VALLEY RGV" |
           Region == "PERMIAN BASIN REGION" |
           Region == "SAN ANTONIO REGION" |
           Region == "TARRANT COUNTY REGION") %>%
  select(Region) %>%
  group_by(Region)  %>%
  summarise(`Number of Vacancies` = n()) 
region_vacancy_count


org_vacancy_count_mean_median_SD_byRegion <- region_vacancy_count %>%
  summarise(`Median Over Regions` = median(`Number of Vacancies`),
            `Mean Over Regions` = mean(`Number of Vacancies`),
            `SD Over Regions` = sd(`Number of Vacancies`)) 
  
org_vacancy_count_mean_median_SD_byRegion


#---------------------------------------------

#f-2 (region)
region_fmla_count <-schools_region_FMLA %>%
 mutate(Region = RegionDescription) %>%
  filter(Region == "Austin" |
           Region == "El Paso" |
           Region == "Greater Houston Area" |
           Region == "Lower Valley"|
           Region == "Upper Valley"|
           Region == "Mid Valley" |
           Region == "Permian Basin" |
           Region == "West San Antonio" |
           Region == "East San Antonio"  |
           Region == "Tarrant County") %>%
  filter(total_days_out >0) %>%
  select(Region) %>%
  group_by(Region)  %>%
  summarise(`Number of Leaves for FMLA` = n())
region_fmla_count


org_fmla_count_mean_median_SD_byRegion <- region_fmla_count %>%
  summarise(`Median Over Regions` = median(`Number of Leaves for FMLA`),
            `Mean Over Regions` = mean(`Number of Leaves for FMLA`),
            `SD Over Regions` = sd(`Number of Leaves for FMLA`)) 
  
org_fmla_count_mean_median_SD_byRegion





```

#Region
#3) What is the most # of vacancies at one "time" (time = week, month, quarter, semester)?
```{r}
#use lubridate?

#try Month first, searching for "01" or "02"


```

#Region
#4) Add box plots and Histograms.
```{r}
#4) Add box plots and histograms.  
#region
#f-4)   

#1) How long are vacancies/FMLA

#VACANCY
#Data Prep
hist_prep_data <- jobvite_staffing_vacancies %>%
  mutate("Vacancy Length in Days" = total_days_vacancy) %>%
  select(region.x, `Vacancy Length in Days`) 
hist_prep_data  

#Austin
Austin_Region <- hist_prep_data %>%
  filter(region.x == "AUSTIN REGION")
Austin_Region 

hist(Austin_Region$`Vacancy Length in Days`)

#El Paso
El_Paso_Region <- hist_prep_data %>%
  filter(region.x == "EL PASO REGION")
El_Paso_Region 

hist(El_Paso_Region$`Vacancy Length in Days`)

#Greater Houston
Greater_Houston_Region <- hist_prep_data %>%
  filter(region.x == "GREATER HOUSTON REGION")
Greater_Houston_Region

hist(Greater_Houston_Region$`Vacancy Length in Days`)

#Lower Valley RGV
Lower_Valley_RGV <- hist_prep_data %>%
  filter(region.x == "LOWER VALLEY RGV")
Lower_Valley_RGV

hist(Lower_Valley_RGV$`Vacancy Length in Days`)

#Upper Valley RGV
Upper_Valley_RGV <- hist_prep_data %>%
  filter(region.x == "UPPER VALLEY RGV")
Upper_Valley_RGV 

hist(Upper_Valley_RGV$`Vacancy Length in Days`)

#Mid Valley RGV
Mid_Valley_RGV <- hist_prep_data %>%
  filter(region.x == "MID VALLEY RGV")
Mid_Valley_RGV 

hist(Mid_Valley_RGV$`Vacancy Length in Days`)

#Permian Basin Region
Permian_Basin_Region <- hist_prep_data %>%
  filter(region.x == "PERMIAN BASIN REGION")
Permian_Basin_Region 

hist(Permian_Basin_Region$`Vacancy Length in Days`)

#San Antonio
San_Antonio_Region <- hist_prep_data %>%
  filter(region.x == "SAN ANTONIO REGION")
San_Antonio_Region 

hist(San_Antonio_Region$`Vacancy Length in Days`)

#Tarrant County
Tarrant_County_Region <- hist_prep_data %>%
  filter(region.x == "TARRANT COUNTY REGION")
Tarrant_County_Region

hist(Tarrant_County_Region$`Vacancy Length in Days`)

#EXAMPLE Historgram
# not_first_yr <- data1 %>%
#   group_by(EmployeeID, FirstYearTeacher) %>%
#   filter(FirstYearTeacher == 0) %>%
#   summarize(Percent_Mastery = mean(Mastery, na.rm = TRUE))
# not_first_yr #approx. 1124 Non-first year teachers in our dataset
# 
# hist(not_first_yr$Percent_Mastery)


#---------------------------------
#FMLA
schools_region_FMLA

hist_prep_region_fmla_length <- schools_region_FMLA %>%
  mutate(Region = RegionDescription) %>%
  mutate(`Length of FMLA in Days` = total_days_out) %>%
  filter(Region == "Austin" |
            Region == "El Paso" |
            Region == "Greater Houston Area" |
            Region == "Lower Valley"|
            Region == "Upper Valley"|
            Region == "Mid Valley" |
            Region == "Permian Basin" |
            Region == "West San Antonio" |
            Region == "East San Antonio"  |
            Region == "Tarrant County") %>%
   filter(total_days_out >0) %>%
   select(Region, `Length of FMLA in Days`) 
hist_prep_region_fmla_length
  

#facet_wrap(~ align + gender)
#Austin
`Austin` <- hist_prep_region_fmla_length %>%
  filter(Region == "Austin")
`Austin`
hist(`Austin`$`Length of FMLA in Days`)

#El Paso
`El Paso` <- hist_prep_region_fmla_length %>%
  filter(Region == "El Paso")
`El Paso`
hist(`El Paso`$`Length of FMLA in Days`)

#Greater Houston Area
`Greater Houston Area` <- hist_prep_region_fmla_length %>%
  filter(Region == "Greater Houston Area")
`Greater Houston Area`
hist(`Greater Houston Area`$`Length of FMLA in Days`)

#Lower Valley RGV
`Lower Valley` <- hist_prep_region_fmla_length %>%
  filter(Region == "Lower Valley")
`Lower Valley`
hist(`Lower Valley`$`Length of FMLA in Days`)

#Upper Valley RGV
`Upper Valley` <- hist_prep_region_fmla_length %>%
  filter(Region == "Upper Valley")
`Upper Valley`
hist(`Upper Valley`$`Length of FMLA in Days`)

#Mid Valley RGV
`Mid Valley` <- hist_prep_region_fmla_length %>%
  filter(Region == "Mid Valley")
`Mid Valley`
hist(`Mid Valley`$`Length of FMLA in Days`)

#Permian Basin
`Permian Basin` <- hist_prep_region_fmla_length %>%
  filter(Region == "Permian Basin")
`Permian Basin`
hist(`Permian Basin`$`Length of FMLA in Days`)

#West San Antonio
`West San Antonio` <- hist_prep_region_fmla_length %>%
  filter(Region == "West San Antonio")
`West San Antonio`
hist(`West San Antonio`$`Length of FMLA in Days`)

#East San Antonio
`East San Antonio` <- hist_prep_region_fmla_length %>%
  filter(Region == "East San Antonio")
`East San Antonio`
hist(`East San Antonio`$`Length of FMLA in Days`)


#Tarrant County
`Tarrant County` <- hist_prep_region_fmla_length %>%
  filter(Region == "Tarrant County")
`Tarrant County`
hist(`Tarrant County`$`Length of FMLA in Days`)



```

#barchart (vacancy count)
#region
```{r}
#BAR
#vacancy counts


#2) count of vacancies - bar chart
# region_vacancy_count <-jobvite_staffing_vacancies %>%
#   mutate(Region = region.x) %>%
#   filter(Region == "AUSTIN REGION" |
#            Region == "EL PASO REGION" |
#            Region == "GREATER HOUSTON REGION" |
#            Region == "LOWER VALLEY RGV"|
#            Region == "UPPER VALLEY RGV"|
#            Region == "MID VALLEY RGV" |
#            Region == "PERMIAN BASIN REGION" |
#            Region == "SAN ANTONIO REGION" |
#            Region == "TARRANT COUNTY REGION") %>%
#   select(Region) %>%
#   group_by(Region)  %>%
#   summarise(`Number of Vacancies` = n()) 

#dataset name for counts
region_vacancy_count


plot_vacancy_count <- ggplot(region_vacancy_count, 
                             aes(x = `Number of Vacancies`, 
                                 y = reorder(Region, -`Number of Vacancies`),
                                 fill = Region)) + 
  geom_bar(stat = "identity") +
 
  scale_fill_idea(reverse = FALSE) +
  scale_color_idea() +
  ideacolors::theme_idea_min() +
   #ideacolors::theme_idea_light() +
  #guides(fill = "none", color = "none") +
   theme(legend.position="none") +
  labs(
    #x= "Number of Staffing Vacancies",
      y ="Region",
       title = "Number of Staffing Vacancies by Region",
       subtitle = "for SY 23-24")

plot_vacancy_count

#EXAMPLE CODE
#REF: https://bookdown.org/dli/rguide/bar-graph.html#ggplot2-bar-graph

# ggplot(data = IB, aes(x = reorder(Browser, -Users), 
#                            y = Users, fill = Browser)) + 
#    geom_bar(stat = "identity") + 
#    labs(title = "2018 Internet Browser Users (in millions)",
#         x = "Internet Browser", y = "Users")

#----------------------------------------------
#BAR
#FMLA counts

# region_fmla_count <-schools_region_FMLA %>%
#  mutate(Region = RegionDescription) %>%
#   filter(Region == "Austin" |
#            Region == "El Paso" |
#            Region == "Greater Houston Area" |
#            Region == "Lower Valley"|
#            Region == "Upper Valley"|
#            Region == "Mid Valley" |
#            Region == "Permian Basin" |
#            Region == "West San Antonio" |
#            Region == "East San Antonio"  |
#            Region == "Tarrant County") %>%
#   filter(total_days_out >0) %>%
#   select(Region) %>%
#   group_by(Region)  %>%
#   summarise(`Number of Leaves for FMLA` = n())

#data for graph
region_fmla_count

plot_fmla_count_region <- ggplot(region_fmla_count, 
                             aes(x = `Number of Leaves for FMLA`, 
                                 y = reorder(Region, -`Number of Leaves for FMLA`),
                                 fill = Region)) + 
  geom_bar(stat = "identity") +
 
  scale_fill_idea(reverse = FALSE) +
  scale_color_idea() +
  ideacolors::theme_idea_min() +
   #ideacolors::theme_idea_light() +
  #guides(fill = "none", color = "none") +
   theme(legend.position="none") +
  labs(
    #x= "Number of Staffing Vacancies",
      y ="Region",
       title = "Number of Teacher Leaves from FMLA Vacancies",
       subtitle = "by Region for SY 23-24")

plot_fmla_count_region

```


#-------------------------
#BOXPLOTS
#F) region
```{r}

#SAMPLE CODE
#B - adding gitter
p_box_all_subjects_2021 <- data_2021_master %>%
  filter(Subject != "NA" | Subject != "Technology") %>%
  ggplot(aes(x= `Year of Teaching at IDEA`,
             y = `Percent of Students Passing`, 
             #fill = as.factor(FirstYearTeacher),
             color =`Year of Teaching at IDEA`)) +
geom_boxplot(outlier.shape = NA, 
             alpha = .25,) +
  geom_jitter(size= 1, alpha =.75, width = .05) +
 
  #facet_grid(Subject~`Year of Teaching at IDEA`, 
  #           scales = "free_y",
              
 #            ) +
  labs(title= "20-21 SY: Median Passing Rate for All Subjects Combined")
p_box_all_subjects_2021

```

#D) Campus

```{r}
#look at data
courses_tm_fmla_staff   #FMLA data (number of days off for FMLA)
jobvite_staffing_vacancies 


#use "campus_upper" for the campus name

```

#D) Campus - 
#1) how long were vacancies/FMLA
```{r}
#1) How long are vacancies (median and mean and SD)?

distinct_campus <- jobvite_staffing_vacancies %>%
 mutate(Campus = campus_upper) %>%
    filter(Campus == "HQ RGV" |
           Campus == "HQ SAN ANTONIO"|
           Campus == "HQ TARRANT COUNTY") 
distinct_campus

#f-1) region - VACANCY
campus_median_mean_sd <-jobvite_staffing_vacancies %>%
  mutate(Region = region.x) %>%
  filter(Region == "AUSTIN REGION" |
           Region == "EL PASO REGION" |
           Region == "GREATER HOUSTON REGION" |
           Region == "LOWER VALLEY RGV"|
           Region == "UPPER VALLEY RGV"|
           Region == "MID VALLEY RGV" |
           Region == "PERMIAN BASIN REGION" |
           Region == "SAN ANTONIO REGION" |
           Region == "TARRANT COUNTY REGION") %>%
  mutate(Campus = campus_upper) %>%
    filter(Campus != "HQ RGV") %>%
    filter(Campus != "HQ SAN ANTONIO") %>% 
    filter(Campus != "HQ TARRANT COUNTY") %>%
  select(Campus, total_days_vacancy) %>%
  group_by(Campus)  %>%
  summarise(Median = median(total_days_vacancy),
            Mean = mean(total_days_vacancy),
            SD = sd(total_days_vacancy)) 
  # count()
campus_median_mean_sd


#change data to numeric
# jobvite_staffing_vacancies$employee_id <- as.numeric(jobvite_staffing_vacancies$employee_id)
# jobvite_staffing_vacancies$total_days_vacancy <- as.numeric(jobvite_staffing_vacancies$total_days_vacancy)

#------------------------------------------------------

#d-1) campus - FMLA

#Add Regions to the FMLA data
#get school number and region from schools and regions tables, join to FMLA table 
schools <- ideadata::get_schools() %>%
  mutate(school_number = SchoolNumber) %>%
  select(school_number, RegionAltID) %>%
  collect() 
schools

region <- get_table(.table_name = "Regions", .database_name = "PROD1", 
        .schema = "Schools", .server_name = "RGVPDSD-DWPRD1") %>%          #[RGVPDSD-DWPRD1].[PROD1].[Schools].[Regions]
  mutate(region_id = RegionID) %>%
  select(region_id, RegionDescription, State)
region

#join data
schools_FMLA <- left_join(courses_tm_fmla_staff, schools, by = "school_number") %>%
  mutate(region_id = RegionAltID)
schools_FMLA

schools_region_FMLA <- left_join(schools_FMLA, region, by = "region_id", copy = TRUE)
schools_region_FMLA

#Median, Mean, Mode: FMLA
campus_FMLA_median_mean_sd <-schools_region_FMLA %>%
  mutate(Region = RegionDescription) %>%
  filter(Region == "Austin" |
           Region == "El Paso" |
           Region == "Greater Houston Area" |
           Region == "Lower Valley"|
           Region == "Upper Valley"|
           Region == "Mid Valley" |
           Region == "Permian Basin" |
           Region == "West San Antonio" |
           Region == "East San Antonio"  |
           Region == "Tarrant County") %>%
  mutate(Campus = campus) %>%
  select(Campus, total_days_out) %>%
  filter(total_days_out >0) %>%
  group_by(Campus)  %>%
  summarise(Median = median(total_days_out),
            Mean = mean(total_days_out),
            SD = sd(total_days_out)) 
campus_FMLA_median_mean_sd


```

#D) Campus
#2) Counts - how many vacancies/FMLA leaves

```{r}
#CAMPUS

#2) How many vacancies are there? Count
#f-2 (campus)
campus_vacancy_count <-jobvite_staffing_vacancies %>%
  mutate(Region = region.x) %>%
  filter(Region == "AUSTIN REGION" |
           Region == "EL PASO REGION" |
           Region == "GREATER HOUSTON REGION" |
           Region == "LOWER VALLEY RGV"|
           Region == "UPPER VALLEY RGV"|
           Region == "MID VALLEY RGV" |
           Region == "PERMIAN BASIN REGION" |
           Region == "SAN ANTONIO REGION" |
           Region == "TARRANT COUNTY REGION") %>%
   mutate(Campus = campus_upper) %>%
    filter(Campus != "HQ RGV") %>%
    filter(Campus != "HQ SAN ANTONIO") %>% 
    filter(Campus != "HQ TARRANT COUNTY") %>%
  select(Campus, total_days_vacancy) %>%
  group_by(Campus)  %>%
  summarise(`Number of Vacancies` = n()) 
campus_vacancy_count


org_vacancy_count_mean_median_SD_byCampus <- campus_vacancy_count %>%
  summarise(`Median Over Campuses` = median(`Number of Vacancies`),
            `Mean Over Campuses` = mean(`Number of Vacancies`),
            `SD Over Campuses` = sd(`Number of Vacancies`)) 
  
org_vacancy_count_mean_median_SD_byCampus


#---------------------------------------------

#2 (campus)
campus_fmla_count <-schools_region_FMLA %>%
 mutate(Region = RegionDescription) %>%
  filter(Region == "Austin" |
           Region == "El Paso" |
           Region == "Greater Houston Area" |
           Region == "Lower Valley"|
           Region == "Upper Valley"|
           Region == "Mid Valley" |
           Region == "Permian Basin" |
           Region == "West San Antonio" |
           Region == "East San Antonio"  |
           Region == "Tarrant County") %>%
  filter(total_days_out >0) %>%
   mutate(Campus = campus) %>%hj
  select(Campus) %>%
  group_by(Campus)  %>%
  summarise(`Number of Leaves for FMLA` = n())
campus_fmla_count


org_fmla_count_mean_median_SD_byCampus <- campus_fmla_count %>%
  summarise(`Median Over Campuses` = median(`Number of Leaves for FMLA`),
            `Mean Over Campuses` = mean(`Number of Leaves for FMLA`),
            `SD Over Campuses` = sd(`Number of Leaves for FMLA`)) 
  
org_fmla_count_mean_median_SD_byCampus




```

#D) Campus
#4) Histograms/graphs

```{r}
#Data Prep for campus histograms
hist_prep_data_campus <- jobvite_staffing_vacancies %>%
  mutate("Vacancy Length in Days" = total_days_vacancy) %>%
  mutate(Campus = campus_upper) %>%
   mutate(Region = region.x) %>%
  filter(Region == "AUSTIN REGION" |
           Region == "EL PASO REGION" |
           Region == "GREATER HOUSTON REGION" |
           Region == "LOWER VALLEY RGV"|
           Region == "UPPER VALLEY RGV"|
           Region == "MID VALLEY RGV" |
           Region == "PERMIAN BASIN REGION" |
           Region == "SAN ANTONIO REGION" |
           Region == "TARRANT COUNTY REGION") %>%
  select(Campus, `Vacancy Length in Days`) 
hist_prep_data_campus



#facet_wrap(~ align + gender)
#Austin
Austin_Region <- hist_prep_data %>%
  filter(region.x == "AUSTIN REGION")
Austin_Region 

hist(Austin_Region$`Vacancy Length in Days`)

#El Paso
El_Paso_Region <- hist_prep_data %>%
  filter(region.x == "EL PASO REGION")
El_Paso_Region 

hist(El_Paso_Region$`Vacancy Length in Days`)

#Greater Houston
Greater_Houston_Region <- hist_prep_data %>%
  filter(region.x == "GREATER HOUSTON REGION")
Greater_Houston_Region

hist(Greater_Houston_Region$`Vacancy Length in Days`)

#Lower Valley RGV
Lower_Valley_RGV <- hist_prep_data %>%
  filter(region.x == "LOWER VALLEY RGV")
Lower_Valley_RGV

hist(Lower_Valley_RGV$`Vacancy Length in Days`)

#Upper Valley RGV
Upper_Valley_RGV <- hist_prep_data %>%
  filter(region.x == "UPPER VALLEY RGV")
Upper_Valley_RGV 

hist(Upper_Valley_RGV$`Vacancy Length in Days`)

#Mid Valley RGV
Mid_Valley_RGV <- hist_prep_data %>%
  filter(region.x == "MID VALLEY RGV")
Mid_Valley_RGV 

hist(Mid_Valley_RGV$`Vacancy Length in Days`)

#Permian Basin Region
Permian_Basin_Region <- hist_prep_data %>%
  filter(region.x == "PERMIAN BASIN REGION")
Permian_Basin_Region 

hist(Permian_Basin_Region$`Vacancy Length in Days`)

#San Antonio
San_Antonio_Region <- hist_prep_data %>%
  filter(region.x == "SAN ANTONIO REGION")
San_Antonio_Region 

hist(San_Antonio_Region$`Vacancy Length in Days`)

#Tarrant County
Tarrant_County_Region <- hist_prep_data %>%
  filter(region.x == "TARRANT COUNTY REGION")
Tarrant_County_Region

hist(Tarrant_County_Region$`Vacancy Length in Days`)

```

#Campus
#4) Bar - Vacancy, FMLA 
```{r}
#data for graph
campus_fmla_count

#vacancy - campus





#-------------------------------
#FMLA  - campus
campus_fmla_count

plot_fmla_count_campus <- ggplot(campus_fmla_count, 
                             aes(x = `Number of Leaves for FMLA`, 
                                 y = reorder(Campus, -`Number of Leaves for FMLA`),
                                 fill = Campus)) + 
  geom_bar(stat = "identity") +
 
  scale_fill_idea(reverse = FALSE) +
  scale_color_idea() +
  ideacolors::theme_idea_min() +
   #ideacolors::theme_idea_light() +
  #guides(fill = "none", color = "none") +
   theme(legend.position="none") +
  labs(
    #x= "Number of Staffing Vacancies",
      y ="Campus",
       title = "Number of Teacher Leaves from FMLA",
       subtitle = "by Campus for SY 23-24")

plot_fmla_count_campus

```


#A) SUBJECT

```{r}
#look at the tables in R
courses_tm_fmla_staff   #FMLA data (number of days off for FMLA)
jobvite_staffing_vacancies   #number of days vacancy
#jobvite

```

#A) subject 
#clean the data/prep the subject column "job_title" to be subject
```{r}

#vacancies data

subject <- jobvite_staffing_vacancies %>%
   mutate("Vacancy Length in Days" = total_days_vacancy) %>%
  mutate(Campus = campus_upper) %>%
  mutate(Subject = job_title) %>%
   mutate(Region = region.x) %>%
  filter(Region == "AUSTIN REGION" |
           Region == "EL PASO REGION" |
           Region == "GREATER HOUSTON REGION" |
           Region == "LOWER VALLEY RGV"|
           Region == "UPPER VALLEY RGV"|
           Region == "MID VALLEY RGV" |
           Region == "PERMIAN BASIN REGION" |
           Region == "SAN ANTONIO REGION" |
           Region == "TARRANT COUNTY REGION") %>%
  filter(Subject != "Executive Campus Leadership") %>%
   mutate(Campus = campus_upper) %>%
    filter(Campus != "HQ RGV") %>%
    filter(Campus != "HQ SAN ANTONIO") %>% 
    filter(Campus != "HQ TARRANT COUNTY") %>%
  select(employee_id, Subject, "Vacancy Length in Days")      #add in "campus_upper" to get campus name, "region.x" to get region name 
subject


#distinct subjects
subject_distinct <- subject %>%
  select(Subject) %>%
  distinct()
subject_distinct

#social studides
#math
#science
#english language arts

#when col "Subject" is "teaching - social studies" replace it with "social studies".
subject$Subject[subject$Subject == "Teaching - Math"] <- "Math"

#when col "Subject" is "teaching - social studies" replace it with "social studies".
subject$Subject[subject$Subject == "Teaching - Science"] <- "Science"

#when col "Subject" is "teaching - social studies" replace it with "social studies".
subject$Subject[subject$Subject == "Teaching - English Language Arts"] <- "English Language Arts"

#when col "Subject" is "teaching - social studies" replace it with "social studies".
subject$Subject[subject$Subject == "Teaching - Social Studies"] <- "Social Studies"


#Change data from character to numeric (col Hired)
#job_1920$Hired <- as.numeric(job_1920$Hired)

#Change data from character to numeric (col Hired)
subject$Subject <- as.character(subject$Subject)
subject


#distinct subjects
subject_distinct2 <- subject %>%
  select(Subject) %>%
  distinct()
subject_distinct2

```


#A) Subject - 
#1) how long were vacancies/FMLA
```{r}
#1) How long are vacancies (median and mean and SD)?

#A-1) Subject - VACANCY
subject_median_mean_sd <- subject %>%
  select(Subject, `Vacancy Length in Days`) %>%
  #filter(Subject != "English Language Arts") %>%
  group_by(Subject)  %>%
  summarise(Median = median(`Vacancy Length in Days`),
            Mean = mean(`Vacancy Length in Days`),
            SD = sd(`Vacancy Length in Days`)) 
  # count()
subject_median_mean_sd

#------------------------------------------------------
#A-1) Subject - FMLA

#Add Regions to the FMLA data
#get school number and region from schools and regions tables, join to FMLA table 
schools <- ideadata::get_schools() %>%
  mutate(school_number = SchoolNumber) %>%
  select(school_number, RegionAltID) %>%
  collect() 
schools

region <- get_table(.table_name = "Regions", .database_name = "PROD1", 
        .schema = "Schools", .server_name = "RGVPDSD-DWPRD1") %>%          #[RGVPDSD-DWPRD1].[PROD1].[Schools].[Regions]
  mutate(region_id = RegionID) %>%
  select(region_id, RegionDescription, State)
region

#join data
schools_FMLA <- left_join(courses_tm_fmla_staff, schools, by = "school_number") %>%
  mutate(region_id = RegionAltID)
schools_FMLA

schools_region_FMLA <- left_join(schools_FMLA, region, by = "region_id", copy = TRUE)
schools_region_FMLA

#Median, Mean, Mode: FMLA
subject_FMLA_median_mean_sd <-schools_region_FMLA %>%
  mutate(Region = RegionDescription) %>%
  filter(Region == "Austin" |
           Region == "El Paso" |
           Region == "Greater Houston Area" |
           Region == "Lower Valley"|
           Region == "Upper Valley"|
           Region == "Mid Valley" |
           Region == "Permian Basin" |
           Region == "West San Antonio" |
           Region == "East San Antonio"  |
           Region == "Tarrant County") %>%
  # filter(campus != "HQ RGV" |                       #remove 3 HQ's from campus name, since we only want actual schools
  #          campus != "HQ SAN ANTONIO" |
  #          campus != "HQ TARRANT COUNTY") %>%
  mutate(Subject =course_credit_type) %>%
  filter(total_days_out > 0) %>%
  select(employee_id, Subject, total_days_out)
subject_FMLA_median_mean_sd
  
#distinct subjects
subject_distinct_fmla <- subject_FMLA_median_mean_sd %>%
  select(Subject) %>%
  distinct()
subject_distinct_fmla

#social studides
#math
#science
#english language arts

#when col "Subject" is "teaching - social studies" replace it with "social studies".
subject_FMLA_median_mean_sd$Subject[campus_FMLA_median_mean_sd$Subject == "MATH"] <- "Math"

#when col "Subject" is "teaching - social studies" replace it with "social studies".
subject_FMLA_median_mean_sd$Subject[campus_FMLA_median_mean_sd$Subject == "SCI"] <- "Science"

#when col "Subject" is "teaching - social studies" replace it with "social studies".
subject_FMLA_median_mean_sd$Subject[campus_FMLA_median_mean_sd$Subject == "ELA"] <- "English Language Arts"

#when col "Subject" is "teaching - social studies" replace it with "social studies".
subject_FMLA_median_mean_sd$Subject[campus_FMLA_median_mean_sd$Subject == "SS"] <- "Social Studies"


#Change data from character to numeric (col Hired)
subject_FMLA_median_mean_sd$Subject <- as.character(campus_FMLA_median_mean_sd$Subject)
subject_FMLA_median_mean_sd


#distinct subjects
subject_distinct2_FMLA <- subject %>%
  select(Subject) %>%
  distinct()
subject_distinct2_FMLA

#-----------------------------
#summary stats - FMLA/Subject
subject_FMLA_median_mean_sd_chart <- subject_FMLA_median_mean_sd %>%
  select(Subject, total_days_out) %>%
  filter(total_days_out >0) %>%
  group_by(Subject)  %>%
  summarise(Median = median(total_days_out),
            Mean = mean(total_days_out),
            SD = sd(total_days_out)) 
subject_FMLA_median_mean_sd_chart

```

#A) Subject
#2) Counts - how many vacancies/FMLA leaves

```{r}
#SUBJECT

#2) How manyare there? Count
#A-2 (Subject)

#VACANCY
subject_vacancy_count <-subject %>%
  select(Subject, `Vacancy Length in Days`) %>%
  group_by(Subject)  %>%
  summarise(`Number of Vacancies` = n()) 
subject_vacancy_count


org_vacancy_count_mean_median_SD_bySubject <- subject_vacancy_count %>%
  summarise(`Median Over Subjects` = median(`Number of Vacancies`),
            `Mean Over Subjects` = mean(`Number of Vacancies`),
            `SD Over Subjects` = sd(`Number of Vacancies`)) 
  
org_vacancy_count_mean_median_SD_bySubject


#---------------------------------------------

#a-2 (subject)
#FMLA
subject_fmla_count <-subject_FMLA_median_mean_sd %>%
  #mutate(`Number of Days of FMLA` = total_days_out) %>%
  select(Subject) %>%
  group_by(Subject)  %>%
  summarise(`Number of Leaves for FMLA` = n())
subject_fmla_count


org_fmla_count_mean_median_SD_bySubject <- subject_fmla_count %>%
  summarise(`Median Over Subject` = median(`Number of Leaves for FMLA`),
            `Mean Over Subject` = mean(`Number of Leaves for FMLA`),
            `SD Over Subject` = sd(`Number of Leaves for FMLA`)) 
  
org_fmla_count_mean_median_SD_bySubject




```
#A) subject
#4) histograms

```{r}
#Data prep for Subjects histograms

#vacancies data

subject


hist_prep_data_subject_VAC <- subject %>%
  # mutate(Campus = campus_upper) %>%
  #  mutate(Region = region.x) %>%
  # filter(Region == "AUSTIN REGION" |
  #          Region == "EL PASO REGION" |
  #          Region == "GREATER HOUSTON REGION" |
  #          Region == "LOWER VALLEY RGV"|
  #          Region == "UPPER VALLEY RGV"|
  #          Region == "MID VALLEY RGV" |
  #          Region == "PERMIAN BASIN REGION" |
  #          Region == "SAN ANTONIO REGION" |
  #          Region == "TARRANT COUNTY REGION") %>%
  select(Subject, `Vacancy Length in Days`) 
hist_prep_data_subject_VAC



#facet_wrap(~ align + gender)
#MATH
`Math` <- hist_prep_data_subject_VAC %>%
  filter(Subject == "Math")
`Math`
hist(`Math`$`Vacancy Length in Days`)

#SCIENCE
`Science` <- hist_prep_data_subject_VAC %>%
  filter(Subject == "Science")
`Science`
hist(`Science`$`Vacancy Length in Days`)
#MATH

`English Language Arts` <- hist_prep_data_subject_VAC %>%
  filter(Subject == "English Language Arts")
`English Language Arts`
hist(`English Language Arts`$`Vacancy Length in Days`)

#MATH
`Social Studies` <- hist_prep_data_subject_VAC %>%
  filter(Subject == "Social Studies")
`Social Studies`
hist(`Social Studies`$`Vacancy Length in Days`)



#------------------------------------

#FMLA data

hist_prep_data_subject_FMLA <- subject_FMLA_median_mean_sd %>%
  mutate("Total Days of FMLA" = total_days_out) %>%
  # mutate(Campus = campus_upper) %>%
  #  mutate(Region = region.x) %>%
  # filter(Region == "AUSTIN REGION" |
  #          Region == "EL PASO REGION" |
  #          Region == "GREATER HOUSTON REGION" |
  #          Region == "LOWER VALLEY RGV"|
  #          Region == "UPPER VALLEY RGV"|
  #          Region == "MID VALLEY RGV" |
  #          Region == "PERMIAN BASIN REGION" |
  #          Region == "SAN ANTONIO REGION" |
  #          Region == "TARRANT COUNTY REGION") %>%
  select(Subject, `Total Days of FMLA`) 
hist_prep_data_subject_FMLA



#facet_wrap(~ align + gender)
#MATH
Math <- hist_prep_data_subject_FMLA %>%
  filter(Subject == "Math")
Math
hist(Math$`Total Days of FMLA`)

#SCIENCE
Science <- hist_prep_data_subject_FMLA %>%
  filter(Subject == "Science")
Science
hist(Science$`Total Days of FMLA`)
#MATH

English_Language_Arts <- hist_prep_data_subject_FMLA %>%
  filter(Subject == "English Language Arts")
English_Language_Arts
hist(English_Language_Arts$`Total Days of FMLA`)

#MATH
Social_Studies <- hist_prep_data_subject_FMLA %>%
  filter(Subject == "Social Studies")
Social_Studies
hist(Social_Studies$`Total Days of FMLA`)

```


#4) BAR
#A) Subject 
```{r}

#VACANCY - subject
#dataset name for counts
subject_vacancy_count


plot_vacancy_count_subject <- ggplot(subject_vacancy_count, 
                             aes(x = `Number of Vacancies`, 
                                 y = reorder(Subject, -`Number of Vacancies`),
                                 fill = Subject)) + 
  geom_bar(stat = "identity") +
 
  scale_fill_idea(reverse = FALSE) +
  scale_color_idea() +
  ideacolors::theme_idea_min() +
   #ideacolors::theme_idea_light() +
  #guides(fill = "none", color = "none") +
   theme(legend.position="none") +
  labs(
    #x= "Number of Staffing Vacancies",
      y ="Subject",
       title = "Number of Staffing Vacancies by Subject",
       subtitle = "for SY 23-24")

plot_vacancy_count_subject


#--------------------

#FMLA - subject
subject_fmla_count 

plot_fmla_count_subject <- ggplot(subject_fmla_count, 
                             aes(x = `Number of Leaves for FMLA`, 
                                 y = reorder(Subject, -`Number of Leaves for FMLA`),
                                 fill = Subject)) + 
  geom_bar(stat = "identity") +
 
  scale_fill_idea(reverse = FALSE) +
  scale_color_idea() +
  ideacolors::theme_idea_min() +
   #ideacolors::theme_idea_light() +
  #guides(fill = "none", color = "none") +
   theme(legend.position="none") +
  labs(
    #x= "Number of Staffing Vacancies",
      y ="Subject",
       title = "Number of Teacher Leaves from FMLA",
       subtitle = "by Subject for SY 23-24")

plot_fmla_count_subject



```



#REGION-SUBJECT

```{r}

#1) How long are vacancies (median and mean and SD)?

#vacancy data

#region-subject
subject_region <- jobvite_staffing_vacancies %>%
   mutate("Vacancy Length in Days" = total_days_vacancy) %>%
  mutate(Campus = campus_upper) %>%
  mutate(Subject = job_title) %>%
   mutate(Region = region.x) %>%
  filter(Region == "AUSTIN REGION" |
           Region == "EL PASO REGION" |
           Region == "GREATER HOUSTON REGION" |
           Region == "LOWER VALLEY RGV"|
           Region == "UPPER VALLEY RGV"|
           Region == "MID VALLEY RGV" |
           Region == "PERMIAN BASIN REGION" |
           Region == "SAN ANTONIO REGION" |
           Region == "TARRANT COUNTY REGION") %>%
  filter(Subject != "Executive Campus Leadership") %>%
  select(employee_id, Region, Subject, "Vacancy Length in Days")      #add in "campus_upper" to get campus name, "region.x" to get region name 
subject_region

#change names of subjects to exclude "teacher" 
#when col "Subject" is "teaching - social studies" replace it with "social studies".
subject_region$Subject[subject_region$Subject == "Teaching - Math"] <- "Math"

#when col "Subject" is "teaching - social studies" replace it with "social studies".
subject_region$Subject[subject_region$Subject == "Teaching - Science"] <- "Science"

#when col "Subject" is "teaching - social studies" replace it with "social studies".
subject_region$Subject[subject_region$Subject == "Teaching - English Language Arts"] <- "English Language Arts"

#when col "Subject" is "teaching - social studies" replace it with "social studies".
subject_region$Subject[subject_region$Subject == "Teaching - Social Studies"] <- "Social Studies"


#Change data from character to numeric (col Hired)
#job_1920$Hired <- as.numeric(job_1920$Hired)

#Change data from character to numeric (col Hired)
subject_region$Subject <- as.character(subject_region$Subject)
subject_region


#distinct subjects
subject_region_distinct2 <- subject_region %>%
  select(Subject) %>%
  distinct()
subject_region_distinct2

#------------------
#1) how long?

#subject-region - VACANCY
region_subject_median_mean_sd <-subject_region %>%  #(df "subject_region" from above that was cleaned and filtered for region, subject)
  # filter(Region == "AUSTIN REGION" |
  #          Region == "EL PASO REGION" |
  #          Region == "GREATER HOUSTON REGION" |
  #          Region == "LOWER VALLEY RGV"|
  #          Region == "UPPER VALLEY RGV"|
  #          Region == "MID VALLEY RGV" |
  #          Region == "PERMIAN BASIN REGION" |
  #          Region == "SAN ANTONIO REGION" |
  #          Region == "TARRANT COUNTY REGION") %>%
  select(Region, Subject, `Vacancy Length in Days`) %>%
  group_by(Region, Subject)  %>%
   summarise(Median = median(`Vacancy Length in Days`),
             Mean = mean(`Vacancy Length in Days`),
             SD = sd(`Vacancy Length in Days`)) 

region_subject_median_mean_sd






```













